<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.village.revive.mapper.AttractionMapper">

    <!-- 分页查询景点列表 -->
    <select id="selectAttractionPage" resultType="com.village.revive.dto.AttractionDTO">
        SELECT a.* ,c.name AS categoryName FROM attractions a LEFT JOIN attraction_categories c ON c.id = a.category_id
        WHERE deleted = 0
        <if test="categoryId != null">
            AND category_id = #{categoryId}
        </if>
        <if test="keyword != null and keyword != ''">
            AND (name LIKE CONCAT('%', #{keyword}, '%') OR description LIKE CONCAT('%', #{keyword}, '%'))
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
        ORDER BY sort_order ASC, created_at DESC
    </select>

    <!-- 获取推荐景点列表 -->
    <select id="selectRecommendAttractions" resultType="com.village.revive.entity.Attraction">
        SELECT * FROM attractions 
        WHERE deleted = 0 AND status = 1
        ORDER BY rating DESC, view_count DESC
        <if test="limit != null">
            LIMIT #{limit}
        </if>
    </select>

    <!-- 增加浏览次数 -->
    <update id="incrementViewCount">
        UPDATE attractions SET view_count = view_count + 1 WHERE id = #{id}
    </update>

    <!-- 根据分类ID查询景点列表 -->
    <select id="selectByCategoryId" resultType="com.village.revive.entity.Attraction">
        SELECT * FROM attractions 
        WHERE deleted = 0 AND status = 1 AND category_id = #{categoryId}
        ORDER BY sort_order ASC, created_at DESC
    </select>

    <!-- 获取热门景点列表 -->
    <select id="selectHotAttractions" resultType="com.village.revive.entity.Attraction">
        SELECT * FROM attractions 
        WHERE deleted = 0 AND status = 1
        ORDER BY view_count DESC, rating DESC
        <if test="limit != null">
            LIMIT #{limit}
        </if>
    </select>

</mapper>
